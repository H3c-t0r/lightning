name: Check PR traceability

on:
  push:
    branches: [master, "release/*"]
  pull_request:
    branches: [master, "release/*"]

jobs:
  check-pr-description:
    name: Check PR description
    runs-on: ubuntu-20.04
    steps:

    - uses: actions/checkout@v2

    - name: Set up Python 3.6
      uses: actions/setup-python@v2
      with:
        python-version: 3.6

    - name: Fetch PR Description
      env:
        GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
      run: echo "::set-output name=description::$(gh pr view ${{ env.PR_NUMBER }})"
      id: pr

    - name: Check PR validity
      env:
        PR_DESCRIPTION: ${{ steps.pr.outputs.description }}
      shell: python
      run: |
        import os

        des = os.getenv("PR_DESCRIPTION")

        if '<issue_number>' in des:
          raise Exception
